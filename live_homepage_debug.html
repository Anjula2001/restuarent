<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Homepage Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .iframe-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <h1>üîç Live Homepage Debug - Popular Foods Issue</h1>
    
    <div class="status error">
        <strong>üêõ ISSUE:</strong><br>
        Homepage shows: String Hoppers, Kottu Roti, Fish Ambulthiyal (fallback items)<br>
        Should show: Special Fusion Dish, Sweet and Sour Chicken, Seafood Platter (from API)
    </div>

    <div class="test-container">
        <h2>üì° Direct API Test</h2>
        <button onclick="testDirectAPI()">Test API Directly</button>
        <div id="api-status"></div>
        <div id="api-response" class="log"></div>
    </div>

    <div class="test-container">
        <h2>üè† Live Homepage Analysis</h2>
        <button onclick="loadHomepage()">Load Homepage</button>
        <button onclick="inspectHomepage()">Inspect Popular Foods Section</button>
        <div id="homepage-status"></div>
        <div id="homepage-iframe" class="iframe-container" style="display: none;"></div>
        <div id="homepage-analysis" class="log"></div>
    </div>

    <div class="test-container">
        <h2>üîß JavaScript Console Monitor</h2>
        <button onclick="monitorConsole()">Monitor Console Output</button>
        <div id="console-status"></div>
        <div id="console-output" class="log"></div>
    </div>

    <div class="test-container">
        <h2>üìù Debug Log</h2>
        <div id="debug-log" class="log">Ready to debug...</div>
    </div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const typeIndicator = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logDiv.innerHTML += `[${timestamp}] ${typeIndicator} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        async function testDirectAPI() {
            log('Testing API directly...');
            
            try {
                const response = await fetch('api/menu.php?popular=true&limit=3');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                document.getElementById('api-status').innerHTML = '<div class="status success">‚úÖ API Working</div>';
                document.getElementById('api-response').textContent = 
                    `Response: ${JSON.stringify(data, null, 2)}\n\n` +
                    `Items Found: ${data.length}\n` +
                    `Names: ${data.map(item => item.name).join(', ')}`;
                
                log(`API Success: ${data.length} items - ${data.map(item => item.name).join(', ')}`, 'success');
                
                return data;
                
            } catch (error) {
                document.getElementById('api-status').innerHTML = '<div class="status error">‚ùå API Failed</div>';
                document.getElementById('api-response').textContent = `Error: ${error.message}`;
                log(`API Error: ${error.message}`, 'error');
                return null;
            }
        }

        function loadHomepage() {
            log('Loading homepage in iframe...');
            
            const iframeContainer = document.getElementById('homepage-iframe');
            iframeContainer.innerHTML = '<iframe src="index.html" id="homepage-frame"></iframe>';
            iframeContainer.style.display = 'block';
            
            const iframe = document.getElementById('homepage-frame');
            iframe.onload = function() {
                log('Homepage loaded successfully', 'success');
                document.getElementById('homepage-status').innerHTML = '<div class="status success">‚úÖ Homepage Loaded</div>';
            };
            
            iframe.onerror = function() {
                log('Failed to load homepage', 'error');
                document.getElementById('homepage-status').innerHTML = '<div class="status error">‚ùå Homepage Load Failed</div>';
            };
        }

        function inspectHomepage() {
            log('Inspecting homepage popular foods section...');
            
            const iframe = document.getElementById('homepage-frame');
            if (!iframe) {
                log('Homepage not loaded. Click "Load Homepage" first.', 'warning');
                return;
            }
            
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const foodCardsContainer = iframeDoc.querySelector('.food-cards');
                
                if (foodCardsContainer) {
                    const foodCards = foodCardsContainer.querySelectorAll('.food-card');
                    
                    if (foodCards.length > 0) {
                        log(`Found ${foodCards.length} food cards in popular section`, 'success');
                        
                        let analysis = `Popular Foods Section Analysis:\n`;
                        analysis += `Container found: ‚úÖ\n`;
                        analysis += `Number of items: ${foodCards.length}\n\n`;
                        
                        foodCards.forEach((card, index) => {
                            const title = card.querySelector('h3');
                            const description = card.querySelector('p');
                            const price = card.querySelector('.food-price');
                            
                            analysis += `Item ${index + 1}:\n`;
                            analysis += `  Name: ${title ? title.textContent : 'N/A'}\n`;
                            analysis += `  Description: ${description ? description.textContent : 'N/A'}\n`;
                            analysis += `  Price: ${price ? price.textContent : 'N/A'}\n\n`;
                        });
                        
                        document.getElementById('homepage-analysis').textContent = analysis;
                        
                        // Check if these are the fallback items
                        const firstTitle = foodCards[0].querySelector('h3');
                        if (firstTitle && firstTitle.textContent.includes('String Hoppers')) {
                            log('‚ùå Homepage is showing FALLBACK items (String Hoppers, etc.)', 'error');
                            document.getElementById('homepage-status').innerHTML = '<div class="status error">‚ùå Showing Fallback Items</div>';
                        } else {
                            log('‚úÖ Homepage showing dynamic items', 'success');
                            document.getElementById('homepage-status').innerHTML = '<div class="status success">‚úÖ Showing Dynamic Items</div>';
                        }
                        
                    } else {
                        log('No food cards found in popular section', 'warning');
                        document.getElementById('homepage-analysis').textContent = 'No food cards found in .food-cards container';
                    }
                } else {
                    log('‚ùå .food-cards container not found', 'error');
                    document.getElementById('homepage-analysis').textContent = '.food-cards container not found on homepage';
                }
                
            } catch (error) {
                log(`Cannot inspect homepage: ${error.message}`, 'error');
                document.getElementById('homepage-analysis').textContent = `Inspection error: ${error.message}`;
            }
        }

        function monitorConsole() {
            log('Setting up console monitoring...');
            
            // Override console methods to capture output
            const originalLog = console.log;
            const originalError = console.error;
            
            let consoleOutput = '';
            
            console.log = function(...args) {
                consoleOutput += '[LOG] ' + args.join(' ') + '\n';
                originalLog.apply(console, args);
                updateConsoleOutput();
            };
            
            console.error = function(...args) {
                consoleOutput += '[ERROR] ' + args.join(' ') + '\n';
                originalError.apply(console, args);
                updateConsoleOutput();
            };
            
            function updateConsoleOutput() {
                document.getElementById('console-output').textContent = consoleOutput;
            }
            
            document.getElementById('console-status').innerHTML = '<div class="status info">‚ÑπÔ∏è Console monitoring active</div>';
            log('Console monitoring activated', 'success');
        }

        // Auto-run tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            log('Live Homepage Debug Tool loaded');
            log('üéØ Goal: Find why homepage shows fallback items instead of API data');
            
            // Auto-test API
            setTimeout(testDirectAPI, 1000);
        });
    </script>
</body>
</html>
