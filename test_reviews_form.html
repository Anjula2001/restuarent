<!DOCTYPE html>
<html>
<head>
    <title>Test Reviews Page Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        #results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Test Reviews Page Form</h1>
    
    <div class="test-section">
        <h3>Test Controls</h3>
        <button class="test-button" onclick="openReviewsPage()">Open Reviews Page</button>
        <button class="test-button" onclick="testEmptyForm()">Test Empty Form</button>
        <button class="test-button" onclick="testValidForm()">Test Valid Form</button>
        <button class="test-button" onclick="checkFormElements()">Check Form Elements</button>
    </div>
    
    <div class="test-section">
        <h3>Test Results</h3>
        <div id="results">Click a test button to see results...</div>
    </div>

    <script>
        function log(message) {
            const results = document.getElementById('results');
            results.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            console.log(message);
        }

        function clearResults() {
            document.getElementById('results').textContent = '';
        }

        function openReviewsPage() {
            clearResults();
            log('Opening reviews page in new window...');
            window.open('http://localhost:8000/reviews.html', 'reviewsWindow');
        }

        async function testEmptyForm() {
            clearResults();
            log('Testing form submission with empty fields...');
            
            try {
                // Simulate the validation logic
                const name = '';
                const rating = null;
                const reviewText = '';
                
                log('Form data: name="' + name + '", rating=' + rating + ', reviewText="' + reviewText + '"');
                
                if (!name) {
                    log('❌ Expected result: "Please enter your name."');
                    return;
                }
                
                if (!rating) {
                    log('❌ Expected result: "Please select a rating by clicking on the stars."');
                    return;
                }
                
                if (!reviewText) {
                    log('❌ Expected result: "Please write your review."');
                    return;
                }
                
                if (reviewText.length < 10) {
                    log('❌ Expected result: "Please write at least 10 characters for your review."');
                    return;
                }
                
                log('✅ All validations passed');
                
            } catch (error) {
                log('❌ Error during test: ' + error.message);
            }
        }

        async function testValidForm() {
            clearResults();
            log('Testing form submission with valid data...');
            
            try {
                const testData = {
                    customer_name: 'Test User',
                    rating: '5',
                    review_text: 'This is a test review with more than 10 characters to meet the validation requirements.',
                    created_at: new Date().toISOString()
                };
                
                log('Testing with valid data:');
                log('- Name: "' + testData.customer_name + '"');
                log('- Rating: ' + testData.rating + ' stars');
                log('- Review: "' + testData.review_text + '" (' + testData.review_text.length + ' chars)');
                
                // Test the API endpoint
                log('Sending POST request to API...');
                const response = await fetch('http://localhost:8000/api/reviews.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                log('Response status: ' + response.status);
                
                if (!response.ok) {
                    throw new Error('API response not ok: ' + response.status);
                }
                
                const result = await response.json();
                log('API response: ' + JSON.stringify(result, null, 2));
                log('✅ API test successful!');
                
            } catch (error) {
                log('❌ Error during API test: ' + error.message);
            }
        }

        function checkFormElements() {
            clearResults();
            log('This test would check form elements on the reviews page.');
            log('Please open the reviews page and check the browser console for debug information.');
            log('Look for:');
            log('- [DEBUG] DOM Content Loaded - Starting initialization...');
            log('- [DEBUG] Attempting to attach event listener to submitReviewBtn');
            log('- [DEBUG] Submit button element: [object HTMLButtonElement]');
            log('');
            log('If you see "Submit button element: null", then there\'s a DOM timing issue.');
            log('If you see the button element, then the event listener should be attached correctly.');
        }
    </script>
</body>
</html>
