<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Popular Foods Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .food-cards { display: flex; gap: 20px; flex-wrap: wrap; }
        .food-card { border: 1px solid #ccc; padding: 15px; border-radius: 8px; width: 250px; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Simple Popular Foods Test</h1>
    
    <button onclick="loadAndDisplayPopularFoods()">Load Popular Foods</button>
    <button onclick="clearConsole()">Clear Console</button>
    
    <div class="debug" id="debug-info">Debug info will appear here...</div>
    
    <div class="food-cards" id="food-cards-container">
        <!-- Popular foods will be loaded here -->
    </div>

    <script>
        function clearConsole() {
            console.clear();
            document.getElementById('debug-info').innerHTML = 'Console cleared...';
        }

        async function loadAndDisplayPopularFoods() {
            const debugDiv = document.getElementById('debug-info');
            const container = document.getElementById('food-cards-container');
            
            debugDiv.innerHTML = 'Starting API call...';
            console.log('=== POPULAR FOODS DEBUG START ===');
            
            try {
                // Step 1: Make API call
                debugDiv.innerHTML += '<br>Making API call to: api/menu.php?popular=true&limit=3';
                console.log('Making API call...');
                
                const response = await fetch('api/menu.php?popular=true&limit=3');
                console.log('Response received:', response);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // Step 2: Parse JSON
                const data = await response.json();
                console.log('Parsed JSON data:', data);
                debugDiv.innerHTML += '<br>API Response: ' + JSON.stringify(data, null, 2);
                
                // Step 3: Check data format
                if (!Array.isArray(data)) {
                    throw new Error('Expected array but got: ' + typeof data);
                }
                
                if (data.length === 0) {
                    debugDiv.innerHTML += '<br>Warning: API returned empty array';
                    console.log('API returned empty array');
                    displayFallbackItems(container);
                    return;
                }
                
                // Step 4: Process and display items
                debugDiv.innerHTML += `<br>Processing ${data.length} items...`;
                console.log(`Processing ${data.length} items:`, data);
                
                const html = data.map(item => {
                    console.log('Processing item:', item);
                    return `
                        <div class="food-card">
                            <h3>${item.name}</h3>
                            <p><strong>Category:</strong> ${item.category}</p>
                            <p><strong>Price:</strong> Rs. ${parseFloat(item.price).toFixed(2)}</p>
                            <p>${item.description || 'No description'}</p>
                            <img src="${item.image_url}" alt="${item.name}" style="width: 100%; height: 120px; object-fit: cover;" 
                                 onerror="this.style.display='none'">
                        </div>
                    `;
                }).join('');
                
                container.innerHTML = html;
                debugDiv.innerHTML += '<br><strong style="color: green;">SUCCESS: Dynamic items displayed!</strong>';
                console.log('SUCCESS: Dynamic items displayed');
                
            } catch (error) {
                console.error('Error loading popular foods:', error);
                debugDiv.innerHTML += '<br><strong style="color: red;">ERROR: ' + error.message + '</strong>';
                debugDiv.innerHTML += '<br>Falling back to static items...';
                
                displayFallbackItems(container);
            }
            
            console.log('=== POPULAR FOODS DEBUG END ===');
        }
        
        function displayFallbackItems(container) {
            console.log('Displaying fallback items');
            const fallbackItems = [
                { name: 'String Hoppers', price: '350.00', description: 'Sri Lankan delicacy' },
                { name: 'Kottu Roti', price: '750.00', description: 'Street food favorite' },
                { name: 'Fish Ambulthiyal', price: '950.00', description: 'Tangy fish curry' }
            ];
            
            const html = fallbackItems.map(item => `
                <div class="food-card" style="background-color: #ffe6e6;">
                    <h3>${item.name} (FALLBACK)</h3>
                    <p><strong>Price:</strong> Rs. ${item.price}</p>
                    <p>${item.description}</p>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }
        
        // Auto-load on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAndDisplayPopularFoods();
        });
    </script>
</body>
</html>
