<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear All Storage and Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-primary { background-color: #007bff; color: white; }
        .result { margin-top: 10px; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üßπ Complete Storage Clear & Test</h1>
    
    <div class="section warning">
        <h2>‚ö†Ô∏è Task: Remove Fallback Items from Order Page</h2>
        <p>The order page shows:</p>
        <ul>
            <li>String Hoppers (FALLBACK) - Rs. 350 each, Quantity: 2, Subtotal: Rs. 700.00</li>
            <li>Kottu Roti (FALLBACK) - Rs. 750 each, Quantity: 1, Subtotal: Rs. 1750.00</li>
        </ul>
    </div>

    <div class="section">
        <h2>üóëÔ∏è Clear All Storage</h2>
        <button class="btn-danger" onclick="clearAllStorage()">Clear ALL localStorage</button>
        <button class="btn-danger" onclick="clearAllCookies()">Clear ALL cookies</button>
        <button class="btn-danger" onclick="clearEverything()">NUCLEAR OPTION: Clear Everything</button>
        <div id="clear-results" class="result"></div>
    </div>

    <div class="section">
        <h2>üîç Test Order Page</h2>
        <button class="btn-primary" onclick="testOrderPageNow()">Open Order Page in New Tab</button>
        <button class="btn-primary" onclick="testWithEmptyCart()">Test Order Page with Empty Cart</button>
        <div id="test-results" class="result"></div>
    </div>

    <script>
        function clearAllStorage() {
            const before = localStorage.length;
            localStorage.clear();
            const after = localStorage.length;
            
            document.getElementById('clear-results').innerHTML = 
                `<span style="color: green;">‚úÖ localStorage cleared: ${before} items removed, ${after} items remaining</span>`;
        }

        function clearAllCookies() {
            // Clear all cookies for this domain
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.replace(/^ +/, "").replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/"); 
            });
            
            document.getElementById('clear-results').innerHTML += 
                `<br><span style="color: green;">‚úÖ All cookies cleared</span>`;
        }

        function clearEverything() {
            // Clear localStorage
            clearAllStorage();
            
            // Clear cookies
            clearAllCookies();
            
            // Clear sessionStorage
            sessionStorage.clear();
            
            // Also clear any cart variables if script.js is loaded
            if (typeof cart !== 'undefined') {
                cart = [];
                if (typeof saveCartToStorage === 'function') {
                    saveCartToStorage();
                }
            }
            
            document.getElementById('clear-results').innerHTML = 
                `<span style="color: green;">‚úÖ EVERYTHING CLEARED: localStorage, sessionStorage, cookies, and cart variable</span>`;
        }

        function testOrderPageNow() {
            const newWindow = window.open('order.html', '_blank');
            document.getElementById('test-results').innerHTML = 
                `<span style="color: blue;">üìÑ Order page opened in new tab. Check if fallback items still appear.</span>`;
        }

        function testWithEmptyCart() {
            // Ensure cart is completely empty
            localStorage.removeItem('restaurant_cart');
            localStorage.removeItem('cart');
            
            if (typeof cart !== 'undefined') {
                cart = [];
            }
            
            // Wait a moment then open order page
            setTimeout(() => {
                window.open('order.html', '_blank');
            }, 100);
            
            document.getElementById('test-results').innerHTML = 
                `<span style="color: blue;">üìÑ Ensured empty cart and opened order page. Check if it shows empty state or fallback items.</span>`;
        }

        // Show current storage state on load
        document.addEventListener('DOMContentLoaded', function() {
            const storageInfo = `
                <div style="background: #f8f9fa; padding: 10px; border-radius: 3px; margin: 10px 0;">
                    <strong>Current Storage State:</strong><br>
                    localStorage items: ${localStorage.length}<br>
                    sessionStorage items: ${sessionStorage.length}<br>
                    document.cookies: ${document.cookie || 'none'}
                </div>
            `;
            document.body.insertAdjacentHTML('afterbegin', storageInfo);
        });
    </script>
</body>
</html>
