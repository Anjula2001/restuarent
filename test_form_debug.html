<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Review Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .star-rating {
            margin: 10px 0;
        }
        .stars-container {
            display: flex;
            flex-direction: row-reverse;
            gap: 5px;
            margin-bottom: 10px;
        }
        .star-input {
            display: none;
        }
        .star-label {
            font-size: 2em;
            color: #ddd;
            cursor: pointer;
            transition: all 0.2s;
        }
        .star-label:hover,
        .star-label.active {
            color: #ffd700;
            transform: scale(1.1);
        }
        .rating-text {
            color: #666;
            font-style: italic;
        }
        button {
            background: #8B5A2B;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #7A4F26;
        }
        .form-message {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .form-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .form-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .debug-info {
            background: #f0f0f0;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Review Form Debug Test</h1>
    
    <div class="debug-info" id="debugInfo">
        Debug info will appear here...
    </div>

    <form id="reviewForm">
        <div class="form-group">
            <label for="reviewerName">Your Name</label>
            <input type="text" id="reviewerName" placeholder="Enter your name">
        </div>
        
        <div class="form-group">
            <label>Rating</label>
            <div class="star-rating">
                <div class="stars-container">
                    <input type="radio" name="rating" value="5" id="star5" class="star-input">
                    <label for="star5" class="star-label">★</label>
                    <input type="radio" name="rating" value="4" id="star4" class="star-input">
                    <label for="star4" class="star-label">★</label>
                    <input type="radio" name="rating" value="3" id="star3" class="star-input">
                    <label for="star3" class="star-label">★</label>
                    <input type="radio" name="rating" value="2" id="star2" class="star-input">
                    <label for="star2" class="star-label">★</label>
                    <input type="radio" name="rating" value="1" id="star1" class="star-input">
                    <label for="star1" class="star-label">★</label>
                </div>
                <div class="rating-text" id="ratingText">Please select a rating</div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="reviewText">Your Review</label>
            <textarea id="reviewText" rows="4" placeholder="Share your experience..."></textarea>
        </div>
        
        <button type="button" id="submitBtn">Submit Review</button>
        
        <div class="form-message" id="formMessage"></div>
    </form>

    <script>
        const API_BASE = 'api';
        
        function updateDebugInfo() {
            const name = document.getElementById('reviewerName').value.trim();
            const rating = document.querySelector('input[name="rating"]:checked');
            const reviewText = document.getElementById('reviewText').value.trim();
            
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `
                <strong>Form State:</strong><br>
                Name: "${name}" (${name ? 'VALID' : 'EMPTY'})<br>
                Rating: ${rating ? rating.value + ' stars' : 'NONE SELECTED'}<br>
                Review Text: "${reviewText}" (${reviewText ? `VALID (${reviewText.length} chars)` : 'EMPTY'})<br>
                <br>
                <strong>Validation Results:</strong><br>
                Name Valid: ${!!name}<br>
                Rating Valid: ${!!rating}<br>
                Text Valid: ${!!reviewText}<br>
                Text Length Valid: ${reviewText.length >= 10}<br>
                Overall Valid: ${!!(name && rating && reviewText && reviewText.length >= 10)}
            `;
        }

        function showMessage(message, type) {
            const messageBox = document.getElementById('formMessage');
            messageBox.textContent = message;
            messageBox.className = 'form-message ' + (type === 'success' ? 'success' : 'error');
            messageBox.style.display = 'block';
        }

        function initializeStarRating() {
            const starLabels = document.querySelectorAll('.star-label');
            const ratingText = document.getElementById('ratingText');
            const ratingTexts = {
                1: 'Poor - Not satisfied',
                2: 'Fair - Below expectations',
                3: 'Good - Meets expectations',
                4: 'Very Good - Above expectations',
                5: 'Excellent - Outstanding!'
            };

            starLabels.forEach((star, index) => {
                const rating = 5 - index;
                
                star.addEventListener('mouseenter', function() {
                    highlightStars(rating);
                    ratingText.textContent = ratingTexts[rating];
                    ratingText.style.color = '#8B5A2B';
                });

                star.addEventListener('click', function() {
                    const radioInput = document.getElementById(`star${rating}`);
                    radioInput.checked = true;
                    highlightStars(rating);
                    ratingText.textContent = ratingTexts[rating];
                    ratingText.style.color = '#8B5A2B';
                    ratingText.style.fontWeight = 'bold';
                    updateDebugInfo();
                });
            });

            const starContainer = document.querySelector('.stars-container');
            if (starContainer) {
                starContainer.addEventListener('mouseleave', function() {
                    const selectedRating = document.querySelector('input[name="rating"]:checked');
                    if (selectedRating) {
                        highlightStars(selectedRating.value);
                        ratingText.textContent = ratingTexts[selectedRating.value];
                        ratingText.style.color = '#8B5A2B';
                        ratingText.style.fontWeight = 'bold';
                    } else {
                        resetStars();
                        ratingText.textContent = 'Please select a rating';
                        ratingText.style.color = '#666';
                        ratingText.style.fontWeight = 'normal';
                    }
                });
            }
        }

        function highlightStars(rating) {
            const starLabels = document.querySelectorAll('.star-label');
            starLabels.forEach((star, index) => {
                const starRating = 5 - index;
                if (starRating <= rating) {
                    star.style.color = '#ffd700';
                    star.style.transform = 'scale(1.1)';
                } else {
                    star.style.color = '#ddd';
                    star.style.transform = 'scale(1)';
                }
            });
        }

        function resetStars() {
            const starLabels = document.querySelectorAll('.star-label');
            starLabels.forEach(star => {
                star.style.color = '#ddd';
                star.style.transform = 'scale(1)';
            });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeStarRating();
            updateDebugInfo();
            
            // Update debug info on input changes
            document.getElementById('reviewerName').addEventListener('input', updateDebugInfo);
            document.getElementById('reviewText').addEventListener('input', updateDebugInfo);
        });

        document.getElementById('submitBtn').addEventListener('click', async function() {
            const name = document.getElementById('reviewerName').value.trim();
            const rating = document.querySelector('input[name="rating"]:checked');
            const reviewText = document.getElementById('reviewText').value.trim();

            console.log('Form validation:', {
                name: name,
                rating: rating ? rating.value : 'null',
                reviewText: reviewText,
                nameEmpty: !name,
                ratingEmpty: !rating,
                reviewTextEmpty: !reviewText
            });

            // Validate fields with specific error messages
            if (!name) {
                showMessage('Please enter your name.', 'error');
                document.getElementById('reviewerName').focus();
                return;
            }

            if (!rating) {
                showMessage('Please select a rating by clicking on the stars.', 'error');
                return;
            }

            if (!reviewText) {
                showMessage('Please write your review.', 'error');
                document.getElementById('reviewText').focus();
                return;
            }

            if (reviewText.length < 10) {
                showMessage('Please write at least 10 characters for your review.', 'error');
                document.getElementById('reviewText').focus();
                return;
            }

            const reviewData = {
                customer_name: name,
                rating: rating.value,
                review_text: reviewText,
                created_at: new Date().toISOString()
            };

            try {
                showMessage('Submitting review...', 'success');
                
                const response = await fetch(`${API_BASE}/reviews.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(reviewData)
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const result = await response.json();
                console.log('Review submitted:', result);

                // Reset form
                document.getElementById('reviewerName').value = '';
                const selectedRating = document.querySelector('input[name="rating"]:checked');
                if (selectedRating) {
                    selectedRating.checked = false;
                }
                document.getElementById('reviewText').value = '';
                resetStars();
                document.getElementById('ratingText').textContent = 'Please select a rating';
                document.getElementById('ratingText').style.color = '#666';
                document.getElementById('ratingText').style.fontWeight = 'normal';

                updateDebugInfo();
                showMessage('Thank you for your review! It has been submitted for moderation.', 'success');
            } catch (error) {
                console.error('Error submitting review:', error);
                showMessage('There was an error submitting your review. Please try again later.', 'error');
            }
        });
    </script>
</body>
</html>
