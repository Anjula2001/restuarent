<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logout Function Test - Grand Restaurant</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #d4af37;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #b8941f;
        }
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Logout Function Test</h1>
        <p>This page tests the logout functionality and authentication system.</p>
        
        <div id="statusContainer"></div>
        
        <h3>Tests:</h3>
        <button onclick="testLogoutFunction()" class="test-button">Test Logout Function</button>
        <button onclick="testAuthCheck()" class="test-button">Test Auth Check</button>
        <button onclick="testLoginRedirect()" class="test-button">Test Login Redirect</button>
        <button onclick="logout()" class="test-button">Actual Logout</button>
        
        <h3>Navigation:</h3>
        <button onclick="window.location.href='index.html'" class="test-button">Go to Home</button>
        <button onclick="window.location.href='profile.html'" class="test-button">Go to Profile</button>
        <button onclick="window.location.href='login.html'" class="test-button">Go to Login</button>
    </div>

    <script src="js/script.js"></script>
    <script>
        function showStatus(message, type) {
            const container = document.getElementById('statusContainer');
            container.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function testLogoutFunction() {
            showStatus('Testing logout function availability...', 'info');
            
            if (typeof logout === 'function') {
                showStatus('✅ Logout function is available globally', 'success');
            } else {
                showStatus('❌ Logout function is NOT available globally', 'error');
            }
        }

        async function testAuthCheck() {
            showStatus('Testing authentication check...', 'info');
            
            try {
                const response = await fetch('api/auth.php?action=check_session');
                const result = await response.json();
                
                if (result.logged_in) {
                    showStatus(`✅ User is logged in. Session active.`, 'success');
                } else {
                    showStatus(`ℹ️ User is not logged in. Guest mode.`, 'info');
                }
            } catch (error) {
                showStatus(`❌ Auth check failed: ${error.message}`, 'error');
            }
        }

        async function testLoginRedirect() {
            showStatus('Testing login redirect...', 'info');
            
            const currentUrl = window.location.href;
            const loginUrl = `login.html?return=${encodeURIComponent(currentUrl)}`;
            
            showStatus(`✅ Login redirect URL: ${loginUrl}`, 'success');
        }

        // Fallback logout function for testing
        if (typeof logout !== 'function') {
            window.logout = async function() {
                showStatus('Using fallback logout function...', 'info');
                
                if (confirm('Are you sure you want to logout?')) {
                    try {
                        const response = await fetch('api/auth.php', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                action: 'logout'
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            localStorage.removeItem('user');
                            showStatus('✅ Logged out successfully!', 'success');
                            
                            setTimeout(() => {
                                window.location.href = 'index.html';
                            }, 2000);
                        } else {
                            showStatus('❌ Logout failed: ' + result.message, 'error');
                        }
                        
                    } catch (error) {
                        showStatus('❌ Logout error: ' + error.message, 'error');
                    }
                }
            };
        }

        // Test on page load
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('Page loaded. Ready for testing.', 'info');
            
            // Auto-test function availability
            setTimeout(() => {
                testLogoutFunction();
            }, 1000);
        });
    </script>
</body>
</html>
