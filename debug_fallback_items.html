<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Fallback Items</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .code { background-color: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; }
        button { padding: 10px 15px; margin: 5px; border: none; border-radius: 3px; cursor: pointer; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
    </style>
</head>
<body>
    <h1>üîç Debug Fallback Items Investigation</h1>
    
    <div class="section warning">
        <h2>üéØ Task: Remove String Hoppers (FALLBACK) and Kottu Roti (FALLBACK)</h2>
        <p>These items are showing in the order page "üõí Your Items" section and need to be removed.</p>
    </div>

    <div class="section">
        <h2>üß™ LocalStorage Cart Contents</h2>
        <button class="btn-primary" onclick="checkLocalStorage()">Check Cart in LocalStorage</button>
        <div id="localStorage-result" class="code" style="margin-top: 10px;"></div>
    </div>

    <div class="section">
        <h2>üîÑ Cart Variable State</h2>
        <button class="btn-primary" onclick="checkCartVariable()">Check Global Cart Variable</button>
        <div id="cart-variable-result" class="code" style="margin-top: 10px;"></div>
    </div>

    <div class="section">
        <h2>üßπ Clear Cart Actions</h2>
        <button class="btn-danger" onclick="clearLocalStorageCart()">Clear LocalStorage Cart</button>
        <button class="btn-danger" onclick="clearGlobalCart()">Clear Global Cart Variable</button>
        <button class="btn-success" onclick="refreshCheck()">Refresh & Check Again</button>
        <div id="clear-result" style="margin-top: 10px;"></div>
    </div>

    <div class="section">
        <h2>üìä All LocalStorage Keys</h2>
        <button class="btn-primary" onclick="listAllStorageKeys()">List All Storage Keys</button>
        <div id="all-keys-result" class="code" style="margin-top: 10px;"></div>
    </div>

    <div class="section">
        <h2>üîó Quick Links</h2>
        <button class="btn-primary" onclick="openOrderPage()">Open Order Page</button>
        <button class="btn-primary" onclick="openMenuPage()">Open Menu Page</button>
    </div>

    <script src="js/script.js"></script>
    <script>
        function checkLocalStorage() {
            const cartData = localStorage.getItem('restaurant_cart');
            const result = document.getElementById('localStorage-result');
            
            if (cartData) {
                try {
                    const parsedCart = JSON.parse(cartData);
                    result.innerHTML = `
                        <strong>Found cart in localStorage:</strong><br>
                        Raw data: ${cartData}<br><br>
                        <strong>Parsed cart (${parsedCart.length} items):</strong><br>
                        ${JSON.stringify(parsedCart, null, 2)}
                    `;
                    
                    // Check for fallback items
                    const fallbackItems = parsedCart.filter(item => 
                        item.name && (
                            item.name.includes('String Hoppers') || 
                            item.name.includes('Kottu Roti') ||
                            item.name.includes('FALLBACK')
                        )
                    );
                    
                    if (fallbackItems.length > 0) {
                        result.innerHTML += `<br><br><strong style="color: red;">‚ö†Ô∏è FOUND FALLBACK ITEMS:</strong><br>${JSON.stringify(fallbackItems, null, 2)}`;
                    }
                    
                } catch (error) {
                    result.innerHTML = `<strong style="color: red;">Error parsing cart:</strong> ${error.message}<br>Raw data: ${cartData}`;
                }
            } else {
                result.innerHTML = '<strong style="color: green;">No cart found in localStorage</strong>';
            }
        }

        function checkCartVariable() {
            const result = document.getElementById('cart-variable-result');
            
            if (typeof cart !== 'undefined') {
                result.innerHTML = `
                    <strong>Global cart variable found (${cart.length} items):</strong><br>
                    ${JSON.stringify(cart, null, 2)}
                `;
                
                // Check for fallback items
                const fallbackItems = cart.filter(item => 
                    item.name && (
                        item.name.includes('String Hoppers') || 
                        item.name.includes('Kottu Roti') ||
                        item.name.includes('FALLBACK')
                    )
                );
                
                if (fallbackItems.length > 0) {
                    result.innerHTML += `<br><br><strong style="color: red;">‚ö†Ô∏è FOUND FALLBACK ITEMS IN CART VARIABLE:</strong><br>${JSON.stringify(fallbackItems, null, 2)}`;
                }
            } else {
                result.innerHTML = '<strong style="color: orange;">Global cart variable not found</strong>';
            }
        }

        function clearLocalStorageCart() {
            localStorage.removeItem('restaurant_cart');
            document.getElementById('clear-result').innerHTML = '<span style="color: green;">‚úÖ LocalStorage cart cleared</span>';
            setTimeout(() => checkLocalStorage(), 100);
        }

        function clearGlobalCart() {
            if (typeof cart !== 'undefined') {
                cart = [];
                if (typeof saveCartToStorage === 'function') {
                    saveCartToStorage();
                }
                document.getElementById('clear-result').innerHTML = '<span style="color: green;">‚úÖ Global cart variable cleared and saved</span>';
                setTimeout(() => {
                    checkCartVariable();
                    checkLocalStorage();
                }, 100);
            } else {
                document.getElementById('clear-result').innerHTML = '<span style="color: orange;">‚ö†Ô∏è Global cart variable not found</span>';
            }
        }

        function refreshCheck() {
            checkLocalStorage();
            checkCartVariable();
            document.getElementById('clear-result').innerHTML = '<span style="color: blue;">üîÑ Checks refreshed</span>';
        }

        function listAllStorageKeys() {
            const result = document.getElementById('all-keys-result');
            const keys = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                keys.push({
                    key: key,
                    value: value.length > 100 ? value.substring(0, 100) + '...' : value
                });
            }
            
            result.innerHTML = `
                <strong>All localStorage keys (${keys.length}):</strong><br>
                ${keys.map(item => `<strong>${item.key}:</strong> ${item.value}`).join('<br>')}
            `;
        }

        function openOrderPage() {
            window.open('order.html', '_blank');
        }

        function openMenuPage() {
            window.open('menu.html', '_blank');
        }

        // Auto-run checks on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                checkLocalStorage();
                checkCartVariable();
                listAllStorageKeys();
            }, 500);
        });
    </script>
</body>
</html>
