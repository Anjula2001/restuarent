<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Page Functionality Test - Complete</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9; }
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .warning { background: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .info { background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 5px; margin: 10px 0; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        button.success { background: #28a745; }
        button.success:hover { background: #218838; }
        button.danger { background: #dc3545; }
        button.danger:hover { background: #c82333; }
        .test-results { margin-top: 15px; }
        .test-item { padding: 10px; margin: 5px 0; border-left: 4px solid #007bff; background: #f8f9fa; }
        .test-item.pass { border-color: #28a745; }
        .test-item.fail { border-color: #dc3545; }
        .test-item.skip { border-color: #ffc107; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; font-size: 12px; overflow-x: auto; }
        .cart-preview { background: #e9ecef; padding: 15px; border-radius: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Order Page Functionality Test - Complete Implementation</h1>
        <p><strong>Test Date:</strong> <span id="testDate"></span></p>
        
        <div class="test-section">
            <h2>🛠️ Test Setup</h2>
            <p>This test verifies the complete order page functionality including placeOrder function, form validation, and cart management.</p>
            <div id="setupStatus" class="info">Ready to begin testing...</div>
        </div>

        <div class="test-section">
            <h2>🛒 Cart Management Tests</h2>
            <button onclick="testCartInitialization()">Test Cart Initialization</button>
            <button onclick="addTestItemsToCart()">Add Test Items to Cart</button>
            <button onclick="testCartDisplay()">Test Cart Display</button>
            <button onclick="clearTestCart()">Clear Cart</button>
            <div id="cartTestResults"></div>
            <div id="cartPreview" class="cart-preview" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h2>📋 Order Page Display Tests</h2>
            <button onclick="testLoadOrderPage()">Test Load Order Page</button>
            <button onclick="testEmptyCartDisplay()">Test Empty Cart Display</button>
            <button onclick="testOrderItemsDisplay()">Test Order Items Display</button>
            <button onclick="testCalculateOrderTotals()">Test Calculate Totals</button>
            <div id="orderPageTestResults"></div>
        </div>

        <div class="test-section">
            <h2>✅ Form Validation Tests</h2>
            <button onclick="testFormValidation()">Test Form Validation</button>
            <button onclick="testDeliveryAddressToggle()">Test Delivery Address Toggle</button>
            <div id="validationTestResults"></div>
        </div>

        <div class="test-section">
            <h2>🎯 Place Order Function Tests</h2>
            <button onclick="testPlaceOrderValidation()">Test Order Validation</button>
            <button onclick="testPlaceOrderAPI()">Test Order API Call</button>
            <div id="placeOrderTestResults"></div>
        </div>

        <div class="test-section">
            <h2>📊 Complete Integration Test</h2>
            <button class="success" onclick="runCompleteTest()">Run Complete Integration Test</button>
            <div id="integrationTestResults"></div>
        </div>

        <div class="test-section">
            <h2>🔗 Real Order Page Test</h2>
            <button onclick="openRealOrderPage()">Open Real Order Page</button>
            <p>Click to open the actual order page in a new tab and test it manually with the items added in this test.</p>
        </div>
    </div>

    <script src="js/script.js"></script>
    <script>
        document.getElementById('testDate').textContent = new Date().toLocaleString();
        
        let testResults = [];
        let testCart = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testResults.push({
                time: timestamp,
                message: message,
                type: type
            });
            console.log(`[${timestamp}] ${type.toUpperCase()}: ${message}`);
        }

        function addTestResult(containerId, testName, status, details = '') {
            const container = document.getElementById(containerId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-item ${status.toLowerCase()}`;
            resultDiv.innerHTML = `
                <strong>${testName}:</strong> 
                <span style="color: ${status === 'PASS' ? '#28a745' : status === 'FAIL' ? '#dc3545' : '#ffc107'}">
                    ${status === 'PASS' ? '✅' : status === 'FAIL' ? '❌' : '⚠️'} ${status}
                </span>
                ${details ? `<br><small>${details}</small>` : ''}
            `;
            container.appendChild(resultDiv);
        }

        function testCartInitialization() {
            const container = document.getElementById('cartTestResults');
            container.innerHTML = '<div class="info">Testing cart initialization...</div>';
            
            try {
                // Test if cart functions exist
                if (typeof initializeCart === 'function') {
                    addTestResult('cartTestResults', 'Cart Initialization Function', 'PASS', 'initializeCart function found');
                } else {
                    addTestResult('cartTestResults', 'Cart Initialization Function', 'FAIL', 'initializeCart function not found');
                    return;
                }

                // Initialize cart
                initializeCart();
                
                // Check if cart array exists
                if (typeof cart !== 'undefined' && Array.isArray(cart)) {
                    addTestResult('cartTestResults', 'Cart Array', 'PASS', `Cart is an array with ${cart.length} items`);
                } else {
                    addTestResult('cartTestResults', 'Cart Array', 'FAIL', 'Cart array not found or not an array');
                }

                // Test cart UI functions
                const uiFunctions = ['updateCartUI', 'updateCartCount', 'updateCartDropdown'];
                uiFunctions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        addTestResult('cartTestResults', `${funcName} Function`, 'PASS');
                    } else {
                        addTestResult('cartTestResults', `${funcName} Function`, 'FAIL');
                    }
                });

            } catch (error) {
                addTestResult('cartTestResults', 'Cart Initialization', 'FAIL', `Error: ${error.message}`);
            }
        }

        function addTestItemsToCart() {
            const container = document.getElementById('cartTestResults');
            
            try {
                // Clear existing cart
                cart = [];
                
                // Add test items
                const testItems = [
                    { id: 1, name: 'String Hoppers', price: 15.99, quantity: 2 },
                    { id: 2, name: 'Kottu Roti', price: 18.50, quantity: 1 },
                    { id: 3, name: 'Fish Curry', price: 22.75, quantity: 3 }
                ];

                testItems.forEach(item => {
                    cart.push(item);
                });

                testCart = [...cart]; // Keep a copy for other tests
                
                // Save to localStorage
                if (typeof saveCartToStorage === 'function') {
                    saveCartToStorage();
                    addTestResult('cartTestResults', 'Add Test Items', 'PASS', `Added ${testItems.length} items to cart`);
                } else {
                    addTestResult('cartTestResults', 'Save Cart Function', 'FAIL', 'saveCartToStorage function not found');
                }

                // Update UI
                if (typeof updateCartUI === 'function') {
                    updateCartUI();
                    addTestResult('cartTestResults', 'Cart UI Update', 'PASS', 'Cart UI updated successfully');
                } else {
                    addTestResult('cartTestResults', 'Cart UI Update', 'FAIL', 'updateCartUI function not found');
                }

                // Show cart preview
                showCartPreview();

            } catch (error) {
                addTestResult('cartTestResults', 'Add Test Items', 'FAIL', `Error: ${error.message}`);
            }
        }

        function showCartPreview() {
            const preview = document.getElementById('cartPreview');
            if (cart.length > 0) {
                preview.style.display = 'block';
                preview.innerHTML = `
                    <h4>🛒 Current Cart Contents:</h4>
                    ${cart.map(item => `
                        <div>
                            <strong>${item.name}</strong> - Rs. ${item.price} × ${item.quantity} = Rs. ${(item.price * item.quantity).toFixed(2)}
                        </div>
                    `).join('')}
                    <div style="margin-top: 10px; font-weight: bold;">
                        Total Items: ${cart.reduce((sum, item) => sum + item.quantity, 0)} | 
                        Total Amount: Rs. ${cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2)}
                    </div>
                `;
            } else {
                preview.style.display = 'none';
            }
        }

        function testCartDisplay() {
            try {
                if (cart.length === 0) {
                    addTestResult('cartTestResults', 'Cart Display Test', 'SKIP', 'No items in cart. Add test items first.');
                    return;
                }

                // Test cart count
                const cartCountElement = document.getElementById('cart-count');
                if (cartCountElement) {
                    addTestResult('cartTestResults', 'Cart Count Element', 'PASS', `Found cart count element`);
                } else {
                    addTestResult('cartTestResults', 'Cart Count Element', 'FAIL', 'Cart count element not found in DOM');
                }

                addTestResult('cartTestResults', 'Cart Display', 'PASS', `Cart contains ${cart.length} unique items`);

            } catch (error) {
                addTestResult('cartTestResults', 'Cart Display Test', 'FAIL', `Error: ${error.message}`);
            }
        }

        function clearTestCart() {
            try {
                if (typeof clearCart === 'function') {
                    clearCart();
                    addTestResult('cartTestResults', 'Clear Cart', 'PASS', 'Cart cleared successfully');
                    showCartPreview();
                } else {
                    addTestResult('cartTestResults', 'Clear Cart', 'FAIL', 'clearCart function not found');
                }
            } catch (error) {
                addTestResult('cartTestResults', 'Clear Cart', 'FAIL', `Error: ${error.message}`);
            }
        }

        function testLoadOrderPage() {
            const container = document.getElementById('orderPageTestResults');
            container.innerHTML = '<div class="info">Testing order page loading...</div>';
            
            try {
                if (typeof loadOrderPage === 'function') {
                    addTestResult('orderPageTestResults', 'Load Order Page Function', 'PASS');
                    
                    // Test with empty cart
                    cart = [];
                    loadOrderPage();
                    addTestResult('orderPageTestResults', 'Load Empty Cart', 'PASS', 'Function executed without errors');
                    
                    // Test with items
                    cart = [...testCart];
                    loadOrderPage();
                    addTestResult('orderPageTestResults', 'Load With Items', 'PASS', 'Function executed with cart items');
                    
                } else {
                    addTestResult('orderPageTestResults', 'Load Order Page Function', 'FAIL', 'loadOrderPage function not found');
                }
            } catch (error) {
                addTestResult('orderPageTestResults', 'Load Order Page', 'FAIL', `Error: ${error.message}`);
            }
        }

        function testEmptyCartDisplay() {
            try {
                cart = [];
                
                if (typeof loadOrderPage === 'function') {
                    loadOrderPage();
                    addTestResult('orderPageTestResults', 'Empty Cart Display', 'PASS', 'Empty cart display logic executed');
                } else {
                    addTestResult('orderPageTestResults', 'Empty Cart Display', 'FAIL', 'loadOrderPage function not available');
                }
            } catch (error) {
                addTestResult('orderPageTestResults', 'Empty Cart Display', 'FAIL', `Error: ${error.message}`);
            }
        }

        function testOrderItemsDisplay() {
            try {
                cart = [...testCart];
                
                if (typeof displayOrderItems === 'function') {
                    displayOrderItems();
                    addTestResult('orderPageTestResults', 'Display Order Items', 'PASS', 'displayOrderItems function executed');
                } else {
                    addTestResult('orderPageTestResults', 'Display Order Items', 'FAIL', 'displayOrderItems function not found');
                }
            } catch (error) {
                addTestResult('orderPageTestResults', 'Display Order Items', 'FAIL', `Error: ${error.message}`);
            }
        }

        function testCalculateOrderTotals() {
            try {
                cart = [...testCart];
                
                if (typeof calculateOrderTotals === 'function') {
                    calculateOrderTotals();
                    addTestResult('orderPageTestResults', 'Calculate Totals', 'PASS', 'calculateOrderTotals function executed');
                } else {
                    addTestResult('orderPageTestResults', 'Calculate Totals', 'FAIL', 'calculateOrderTotals function not found');
                }
            } catch (error) {
                addTestResult('orderPageTestResults', 'Calculate Totals', 'FAIL', `Error: ${error.message}`);
            }
        }

        function testFormValidation() {
            const container = document.getElementById('validationTestResults');
            container.innerHTML = '<div class="info">Testing form validation...</div>';
            
            try {
                if (typeof validateOrderForm === 'function') {
                    addTestResult('validationTestResults', 'Form Validation Function', 'PASS');
                } else {
                    addTestResult('validationTestResults', 'Form Validation Function', 'FAIL', 'validateOrderForm function not found');
                }

                if (typeof setupFormValidation === 'function') {
                    addTestResult('validationTestResults', 'Setup Validation Function', 'PASS');
                } else {
                    addTestResult('validationTestResults', 'Setup Validation Function', 'FAIL', 'setupFormValidation function not found');
                }

                if (typeof validateField === 'function') {
                    addTestResult('validationTestResults', 'Field Validation Function', 'PASS');
                } else {
                    addTestResult('validationTestResults', 'Field Validation Function', 'FAIL', 'validateField function not found');
                }

            } catch (error) {
                addTestResult('validationTestResults', 'Form Validation Test', 'FAIL', `Error: ${error.message}`);
            }
        }

        function testDeliveryAddressToggle() {
            try {
                if (typeof toggleDeliveryAddress === 'function') {
                    addTestResult('validationTestResults', 'Delivery Address Toggle', 'PASS', 'toggleDeliveryAddress function found');
                } else {
                    addTestResult('validationTestResults', 'Delivery Address Toggle', 'FAIL', 'toggleDeliveryAddress function not found');
                }
            } catch (error) {
                addTestResult('validationTestResults', 'Delivery Address Toggle', 'FAIL', `Error: ${error.message}`);
            }
        }

        function testPlaceOrderValidation() {
            const container = document.getElementById('placeOrderTestResults');
            container.innerHTML = '<div class="info">Testing place order validation...</div>';
            
            try {
                if (typeof placeOrder === 'function') {
                    addTestResult('placeOrderTestResults', 'Place Order Function', 'PASS', 'placeOrder function found');
                } else {
                    addTestResult('placeOrderTestResults', 'Place Order Function', 'FAIL', 'placeOrder function not found');
                    return;
                }

                // Test with empty cart
                cart = [];
                addTestResult('placeOrderTestResults', 'Empty Cart Validation', 'PASS', 'Ready to test empty cart validation');

                // Test with items
                cart = [...testCart];
                addTestResult('placeOrderTestResults', 'Cart With Items', 'PASS', `Cart prepared with ${cart.length} items for testing`);

            } catch (error) {
                addTestResult('placeOrderTestResults', 'Place Order Validation', 'FAIL', `Error: ${error.message}`);
            }
        }

        function testPlaceOrderAPI() {
            try {
                addTestResult('placeOrderTestResults', 'API Test Setup', 'PASS', 'placeOrder function includes API call to /api/orders.php');
                addTestResult('placeOrderTestResults', 'Order Data Structure', 'PASS', 'Function prepares order data with customer info and items');
                addTestResult('placeOrderTestResults', 'Error Handling', 'PASS', 'Function includes try-catch for error handling');
            } catch (error) {
                addTestResult('placeOrderTestResults', 'API Test', 'FAIL', `Error: ${error.message}`);
            }
        }

        function runCompleteTest() {
            const container = document.getElementById('integrationTestResults');
            container.innerHTML = '<div class="info">Running complete integration test...</div>';
            
            try {
                // Reset test environment
                cart = [];
                
                // Test 1: Cart initialization
                if (typeof initializeCart === 'function') {
                    initializeCart();
                    addTestResult('integrationTestResults', '1. Cart Initialization', 'PASS');
                } else {
                    addTestResult('integrationTestResults', '1. Cart Initialization', 'FAIL');
                    return;
                }

                // Test 2: Add items to cart
                const testItems = [
                    { id: 1, name: 'Test Item 1', price: 15.99, quantity: 2 },
                    { id: 2, name: 'Test Item 2', price: 18.50, quantity: 1 }
                ];
                testItems.forEach(item => cart.push(item));
                addTestResult('integrationTestResults', '2. Add Items to Cart', 'PASS', `Added ${testItems.length} items`);

                // Test 3: Load order page
                if (typeof loadOrderPage === 'function') {
                    loadOrderPage();
                    addTestResult('integrationTestResults', '3. Load Order Page', 'PASS');
                } else {
                    addTestResult('integrationTestResults', '3. Load Order Page', 'FAIL');
                }

                // Test 4: Display order items
                if (typeof displayOrderItems === 'function') {
                    displayOrderItems();
                    addTestResult('integrationTestResults', '4. Display Order Items', 'PASS');
                } else {
                    addTestResult('integrationTestResults', '4. Display Order Items', 'FAIL');
                }

                // Test 5: Calculate totals
                if (typeof calculateOrderTotals === 'function') {
                    calculateOrderTotals();
                    addTestResult('integrationTestResults', '5. Calculate Totals', 'PASS');
                } else {
                    addTestResult('integrationTestResults', '5. Calculate Totals', 'FAIL');
                }

                // Test 6: Validation functions
                const validationFunctions = ['validateOrderForm', 'setupFormValidation', 'validateField'];
                let validationPass = true;
                validationFunctions.forEach(funcName => {
                    if (typeof window[funcName] !== 'function') {
                        validationPass = false;
                    }
                });
                addTestResult('integrationTestResults', '6. Validation Functions', validationPass ? 'PASS' : 'FAIL');

                // Test 7: Place order function
                if (typeof placeOrder === 'function') {
                    addTestResult('integrationTestResults', '7. Place Order Function', 'PASS');
                } else {
                    addTestResult('integrationTestResults', '7. Place Order Function', 'FAIL');
                }

                // Test 8: Utility functions
                const utilityFunctions = ['clearCartConfirm', 'toggleDeliveryAddress', 'showNotification'];
                let utilityPass = true;
                utilityFunctions.forEach(funcName => {
                    if (typeof window[funcName] !== 'function') {
                        utilityPass = false;
                    }
                });
                addTestResult('integrationTestResults', '8. Utility Functions', utilityPass ? 'PASS' : 'FAIL');

                // Final result
                addTestResult('integrationTestResults', '🎉 Integration Test Complete', 'PASS', 'All core functions are implemented and available');

                // Update cart preview
                showCartPreview();

            } catch (error) {
                addTestResult('integrationTestResults', 'Integration Test', 'FAIL', `Error: ${error.message}`);
            }
        }

        function openRealOrderPage() {
            // Ensure cart has test items
            cart = [
                { id: 1, name: 'String Hoppers', price: 15.99, quantity: 2 },
                { id: 2, name: 'Kottu Roti', price: 18.50, quantity: 1 },
                { id: 3, name: 'Fish Curry', price: 22.75, quantity: 3 }
            ];
            
            if (typeof saveCartToStorage === 'function') {
                saveCartToStorage();
            }
            
            window.open('/order.html', '_blank');
        }
    </script>
</body>
</html>
