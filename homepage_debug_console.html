<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage Console Debug</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            max-height: 400px;
            background: white;
            border: 2px solid #333;
            padding: 10px;
            overflow-y: auto;
            z-index: 9999;
            font-size: 12px;
        }
        .debug-log { margin: 2px 0; }
        .debug-error { color: red; }
        .debug-success { color: green; }
        .debug-info { color: blue; }
    </style>
</head>
<body>
    <div class="debug-panel" id="debug-panel">
        <h3>Debug Console</h3>
        <button onclick="clearDebugLog()">Clear</button>
        <div id="debug-log"></div>
    </div>

    <!-- Simplified version of homepage popular section -->
    <div class="container">
        <section class="popular-foods">
            <h2>Popular Food Items</h2>
            <div class="food-cards">
                <!-- Popular food items will be loaded dynamically by JavaScript -->
            </div>
        </section>
    </div>

    <script>
        const debugLog = document.getElementById('debug-log');
        
        function logDebug(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `debug-log debug-${type}`;
            div.innerHTML = `${new Date().toLocaleTimeString()}: ${message}`;
            debugLog.appendChild(div);
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message);
        }
        
        function clearDebugLog() {
            debugLog.innerHTML = '';
        }

        // Copy the exact functions from script.js with debug logging
        const API_BASE = 'api';

        async function loadMenuItems() {
            logDebug('loadMenuItems() called', 'info');
            try {
                logDebug('Making API call to: ' + `${API_BASE}/menu.php?popular=true&limit=3`, 'info');
                
                const response = await fetch(`${API_BASE}/menu.php?popular=true&limit=3`);
                logDebug('API response status: ' + response.status, 'info');
                
                const popularItems = await response.json();
                logDebug('API response data: ' + JSON.stringify(popularItems), 'info');
                
                // Update popular foods section with real data from database
                logDebug('Calling updatePopularFoods with items: ' + JSON.stringify(popularItems), 'info');
                updatePopularFoods(popularItems);
            } catch (error) {
                logDebug('Error loading popular menu items: ' + error.message, 'error');
                // Fallback to static items if API fails
                logDebug('Calling updatePopularFoods with empty array (fallback)', 'info');
                updatePopularFoods([]);
            }
        }

        function updatePopularFoods(items) {
            logDebug('updatePopularFoods() called with: ' + JSON.stringify(items), 'info');
            
            // Don't interfere with menu page - check if we're on menu.html
            if (window.location.pathname.includes('menu.html')) {
                logDebug('On menu page - skipping popular foods update to avoid conflicts', 'info');
                return;
            }
            logDebug('Current pathname: ' + window.location.pathname, 'info');
            
            const foodCards = document.querySelector('.food-cards');
            if (!foodCards) {
                logDebug('No food cards container found', 'error');
                return;
            }
            logDebug('Found food-cards container', 'success');

            let popularItems = [];

            // Use dynamic items from database if available
            if (items && items.length > 0) {
                logDebug('Processing ' + items.length + ' dynamic items from database', 'success');
                popularItems = items.map(item => ({
                    id: item.id,
                    name: item.name,
                    description: item.description || `Delicious ${item.name.toLowerCase()}`,
                    price: parseFloat(item.price).toFixed(2),
                    image_url: item.image_url || 'images/popular/2.png'
                }));
                logDebug('Using dynamic popular items from database', 'success');
            } else {
                logDebug('No dynamic items available, using fallback static items', 'info');
                // Fallback to predefined popular items when no dynamic data available
                popularItems = [
                    {
                        id: 'popular-1',
                        name: 'String Hoppers',
                        description: 'A Sri Lankan delicacy, perfect for breakfast or dinner.',
                        price: '350.00',
                        image_url: 'images/popular/1.png'
                    },
                    {
                        id: 'popular-2',
                        name: 'Kottu Roti',
                        description: 'A flavorful Sri Lankan street food favorite.',
                        price: '750.00',
                        image_url: 'images/popular/2.png'
                    },
                    {
                        id: 'popular-3',
                        name: 'Fish Ambulthiyal',
                        description: 'A tangy and spicy fish curry, unique to Sri Lanka.',
                        price: '950.00',
                        image_url: 'images/popular/3.png'
                    }
                ];
                logDebug('Using fallback static popular items', 'info');
            }

            logDebug('Final popularItems array: ' + JSON.stringify(popularItems), 'info');

            foodCards.innerHTML = popularItems.map(item => `
                <div class="food-card">
                    <img src="${item.image_url}" alt="${item.name}" 
                         onerror="console.log('Popular image failed: ${item.image_url}'); this.src='images/popular/2.png';">
                    <div class="food-card-content">
                        <h3>${item.name}</h3>
                        <p>${item.description}</p>
                        <p class="food-price">Rs. ${item.price}</p>
                        <div class="food-card-actions">
                            <div class="quantity-selector">
                                <label>Qty:</label>
                                <input type="number" class="quantity-input" min="1" max="10" value="1" id="qty-${item.id}">
                            </div>
                            <button onclick="alert('Add to cart: ${item.name}')" class="add-to-cart-btn">
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            logDebug('Updated food-cards HTML content', 'success');
        }

        // Load on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            logDebug('DOMContentLoaded event fired', 'info');
            loadMenuItems();
        });
    </script>
</body>
</html>
