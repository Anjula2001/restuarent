<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rice & Curry Fix Verification</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; font-weight: bold; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        iframe { width: 100%; height: 500px; border: 2px solid #007bff; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; background: #007bff; color: white; }
        button:hover { background: #0056b3; }
        .reload-btn { background: #28a745; }
        .reload-btn:hover { background: #218838; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üçõ Rice & Curry Fix Verification</h1>
    <p><strong>Issue:</strong> Rice and curry items not displaying on initial page load</p>
    <p><strong>Fix Applied:</strong> Prevented script.js from interfering with menu page food containers</p>

    <div class="test-container">
        <h2>üß™ Fix Verification Test</h2>
        <button onclick="testFix()">üîç Test Fix</button>
        <button onclick="simulateUserScenario()">üë§ Simulate User Scenario</button>
        <button onclick="clearResults()">üßπ Clear Results</button>
        
        <div id="test-results">
            <div class="status info">Click "Test Fix" to verify the rice & curry display issue is resolved</div>
        </div>
    </div>

    <div class="test-container">
        <h2>üìä Test Results</h2>
        <div id="test-log" class="log">
            Ready to test...
        </div>
    </div>

    <div class="test-container">
        <h2>üñ•Ô∏è Live Menu Page</h2>
        <p>This is the actual menu page. Rice & Curry items should appear immediately on load:</p>
        <button onclick="reloadFrame()" class="reload-btn">üîÑ Reload Menu Page</button>
        <iframe id="menu-frame" src="menu.html"></iframe>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('test-log');
            const entry = `[${timestamp}] ${message}`;
            
            logDiv.innerHTML += `<div class="${type}">${entry}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(entry);
        }

        function updateStatus(message, type = 'info') {
            document.getElementById('test-results').innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function testFix() {
            log('üöÄ Starting fix verification test...', 'info');
            updateStatus('Testing in progress...', 'info');

            try {
                // Test 1: Verify API is working
                log('üì° Testing API endpoint...', 'info');
                const apiResponse = await fetch('api/menu.php');
                const allItems = await apiResponse.json();
                
                const riceItems = allItems.filter(item => {
                    const cat = item.category.toLowerCase();
                    return cat.includes('rice') || cat.includes('curry');
                });
                
                log(`‚úÖ API Test: ${riceItems.length} rice & curry items available`, 'success');

                // Test 2: Check iframe behavior
                log('üñºÔ∏è Testing iframe menu display...', 'info');
                
                setTimeout(() => {
                    const iframe = document.getElementById('menu-frame');
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const riceContainer = iframeDoc.getElementById('rice-curry-items');
                        
                        if (riceContainer) {
                            const displayedItems = riceContainer.children.length;
                            
                            if (displayedItems > 0) {
                                log(`‚úÖ SUCCESS: ${displayedItems} rice & curry items displayed in menu`, 'success');
                                updateStatus(`‚úÖ Fix Successful! ${displayedItems} rice & curry items are displaying correctly`, 'success');
                            } else {
                                log(`‚ùå ISSUE PERSISTS: Rice container is empty`, 'error');
                                updateStatus('‚ùå Issue persists - rice container is empty', 'error');
                                
                                // Check if there's content at all
                                const containerHTML = riceContainer.innerHTML.trim();
                                log(`Container content: "${containerHTML}"`, 'warning');
                            }
                        } else {
                            log(`‚ùå CRITICAL: Rice container not found`, 'error');
                            updateStatus('‚ùå Critical error - rice container not found', 'error');
                        }
                    } catch (error) {
                        log(`‚ùå Iframe access error: ${error.message}`, 'error');
                        updateStatus('‚ùå Cannot access iframe content', 'error');
                    }
                }, 3000); // Wait for menu to load

            } catch (error) {
                log(`‚ùå Test failed: ${error.message}`, 'error');
                updateStatus(`‚ùå Test failed: ${error.message}`, 'error');
            }
        }

        async function simulateUserScenario() {
            log('üë§ Simulating real user scenario...', 'info');
            updateStatus('Simulating user behavior...', 'info');

            // Step 1: Fresh page load
            log('1Ô∏è‚É£ Simulating fresh page load...', 'info');
            reloadFrame();

            setTimeout(() => {
                log('2Ô∏è‚É£ Checking initial display...', 'info');
                checkRiceItems('initial');

                // Step 3: Simulate reload button click
                setTimeout(() => {
                    log('3Ô∏è‚É£ Simulating reload button click...', 'info');
                    const iframe = document.getElementById('menu-frame');
                    
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        const reloadBtn = iframeDoc.querySelector('.reload-menu-btn');
                        
                        if (reloadBtn) {
                            reloadBtn.click();
                            
                            setTimeout(() => {
                                log('4Ô∏è‚É£ Checking display after reload...', 'info');
                                checkRiceItems('after_reload');
                            }, 2000);
                        } else {
                            log('‚ùå Reload button not found', 'error');
                        }
                    } catch (error) {
                        log(`‚ùå Cannot access reload button: ${error.message}`, 'error');
                    }
                }, 2000);
            }, 3000);
        }

        function checkRiceItems(phase) {
            const iframe = document.getElementById('menu-frame');
            
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const riceContainer = iframeDoc.getElementById('rice-curry-items');
                
                if (riceContainer) {
                    const itemCount = riceContainer.children.length;
                    log(`üìä ${phase}: ${itemCount} items in rice container`, itemCount > 0 ? 'success' : 'warning');
                    
                    if (itemCount > 0) {
                        // Check if items look correct
                        const firstItem = riceContainer.children[0];
                        if (firstItem && firstItem.textContent.toLowerCase().includes('rice')) {
                            log(`‚úÖ Items appear to be correct rice/curry items`, 'success');
                        }
                    }
                } else {
                    log(`‚ùå ${phase}: Rice container not found`, 'error');
                }
            } catch (error) {
                log(`‚ùå ${phase}: Cannot check items - ${error.message}`, 'error');
            }
        }

        function reloadFrame() {
            const iframe = document.getElementById('menu-frame');
            iframe.src = iframe.src; // Force reload
            log('üîÑ Menu page reloaded', 'info');
        }

        function clearResults() {
            document.getElementById('test-log').innerHTML = 'Results cleared...';
            document.getElementById('test-results').innerHTML = '<div class="status info">Ready for new test</div>';
        }

        // Auto-run test on load
        document.addEventListener('DOMContentLoaded', function() {
            log('üåü Fix verification tool loaded', 'success');
            log('üìã The fix should prevent script.js from interfering with menu page', 'info');
            
            // Auto-test after a short delay
            setTimeout(() => {
                log('‚è∞ Running automatic verification test...', 'info');
                testFix();
            }, 2000);
        });
    </script>
</body>
</html>
